<!-- Generated by SpecStory -->

# Vueæ–‡ä»¶ä¼˜åŒ–ä¸å†—ä½™ä»£ç æ¸…ç† (2025-05-13 17:43:32)

_**User**_

ä¼˜åŒ–å½“å‰vueæ–‡ä»¶ï¼Œå·²ç»ä¿®æ”¹ä¸ºæ ¹æ®jsonæ•°æ®å±•ç¤ºäº†ï¼Œä¸å†éœ€è¦è§£æexcelï¼ŒæŸ¥çœ‹é‚£äº›ä»£ç æ˜¯å†—ä½™çš„

---

_**Assistant**_



---

[MODE: RESEARCH]

Let me analyze this file to identify redundant code since you've switched to using JSON data directly.

---

<details>
            <summary>Listed directory src/components/work-visualization â€¢ **5** results</summary>
        
| Name |
|-------|
| ğŸ“„ `MonthlyWorkHours.vue` |
| ğŸ“„ `ProjectHoursDistribution.vue` |
| ğŸ“„ `WorkHoursTrend.vue` |
| ğŸ“„ `ProjectFilter.vue` |
| ğŸ“„ `DateRangeFilter.vue` |

</details>

---

<details>
            <summary>Listed directory src/components/utils â€¢ **2** results</summary>
        
| Name |
|-------|
| ğŸ“„ `dataLoader.ts` |
| ğŸ“„ `csvParser.ts` |

</details>

---

Read file: src/types/work-visualization.ts

---

[MODE: INNOVATE]

After analyzing the code, I can see this file contains two overlapping implementations:

1. An older implementation using `loadDashboardData` with dashboard-specific data structures
2. A newer implementation directly loading JSON data with component-specific handling

The newer JSON-based implementation is being used in the template with components like `WorkHoursTrend`, `ProjectHoursDistribution`, and `MonthlyWorkHours`.

The redundant code includes:
- The dashboard data structures and related functions
- Unused chart settings
- Unused computed properties
- Unused utility functions
- Old interface definitions

Let me propose a solution that:
1. Removes all unused/redundant code
2. Keeps only the JSON-based implementation
3. Simplifies the component structure
4. Removes references to Excel/CSV processing

[MODE: PLAN]

I'll create a detailed plan to optimize this Vue file by removing redundant code.

Implementation Checklist:
1. Remove unused imports (BarChart, loadDashboardData)
2. Remove unused interface definitions (HoursTrendData, ProjectDistributionData, MonthlyHoursData, DateRange)
3. Remove the entire dashboard data structure and related code (dashboardData, dateFilter, selectedProjects)
4. Remove unused chart settings (trendChartSettings, projectChartSettings, monthlyChartSettings)
5. Remove unused computed properties (totalHours, projectCount, monthCount)
6. Remove unused functions (formatMonthLabel, loadData, applyFilters, resetFilters)
7. Remove redundant onMounted code that calls loadData()
8. Clean up comments to reflect the JSON-only implementation
9. Verify that all required functionality for the template is preserved

[MODE: EXECUTE]

Executing checklist item 1. Removing unused imports.

---

```diff
  <script lang="ts" setup>
- import { computed, onMounted, reactive, ref } from 'vue'
- import LineChart from '@/components/charts/LineChart.vue'
- import DoughnutChart from '@/components/charts/DoughnutChart.vue'
- import BarChart from '@/components/charts/BarChart.vue'
- import { loadDashboardData } from '@/components/utils/dataLoader'
+ import { computed, onMounted, ref } from 'vue'
  import DateRangeFilter from '@/components/work-visualization/DateRangeFilter.vue'
  import ProjectFilter from '@/components/work-visualization/ProjectFilter.vue'
```

---

Executing checklist item 2-7. Removing unused interfaces, data structures, chart settings, computed properties, and functions.

---

```diff
  import MonthlyWorkHours from '@/components/work-visualization/MonthlyWorkHours.vue'
  import type { FilterState, WorkData } from '@/types/work-visualization'
- 
- // å®šä¹‰æ•°æ®ç±»å‹
- interface HoursTrendData {
-   labels: string[]
-   data: (number | null)[]
- }
- 
- interface ProjectDistributionData {
-   labels: string[]
-   data: number[]
-   percentages: number[]
-   backgroundColor: string[]
- }
- 
- interface MonthlyHoursData {
-   labels: string[]
-   data: number[]
- }
- 
- interface DateRange {
-   start: string
-   end: string
- }
  
  // æ•°æ®åŠ è½½å’Œå¤„ç†ç›¸å…³çŠ¶æ€
  const isLoading = ref(true)
- const dashboardData = reactive({
-   hoursTrend: {
-     labels: [] as string[],
-     data: [] as (number | null)[],
-   },
-   projectDistribution: {
-     labels: [] as string[],
-     data: [] as number[],
-     percentages: [] as number[],
-     backgroundColor: [] as string[],
-   },
-   monthlyHours: {
-     labels: [] as string[],
-     data: [] as number[],
-   },
-   dateRange: {
-     start: '',
-     end: '',
-   },
-   availableProjects: [] as string[],
- })
- 
- // æ—¥æœŸç­›é€‰å™¨
- const dateFilter = reactive({
-   start: '',
-   end: '',
- })
- 
- // é¡¹ç›®ç­›é€‰å™¨
- const selectedProjects = ref<string[]>([])
- 
- // å›¾è¡¨æ˜¾ç¤ºè®¾ç½®
- const trendChartSettings = reactive({
-   title: 'å·¥æ—¶è¶‹åŠ¿',
-   xAxisLabel: 'æ—¥æœŸ',
-   yAxisLabel: 'å·¥æ—¶ (å°æ—¶)',
-   mainColor: '#36A2EB',
- })
- 
- // é¡¹ç›®åˆ†å¸ƒå›¾è¡¨æ˜¾ç¤ºè®¾ç½®
- const projectChartSettings = reactive({
-   title: 'é¡¹ç›®å·¥æ—¶åˆ†å¸ƒ',
-   isDoughnut: true,
- })
- 
- // æœˆåº¦å·¥æ—¶å›¾è¡¨æ˜¾ç¤ºè®¾ç½®
- const monthlyChartSettings = reactive({
-   title: 'æœˆåº¦å·¥æ—¶ç»Ÿè®¡',
-   xAxisLabel: 'æœˆä»½',
-   yAxisLabel: 'å·¥æ—¶ (å°æ—¶)',
-   barColor: '#4BC0C0',
- })
- 
- // æ±‡æ€»ä¿¡æ¯
- const totalHours = computed(() => {
-   if (!dashboardData.hoursTrend.data.length)
-     return 0
-   return dashboardData.hoursTrend.data
-     .filter(h => h !== null)
-     .reduce((sum, h) => sum + (h as number), 0)
- })
- 
- // é¡¹ç›®æ•°é‡
- const projectCount = computed(() => {
-   return dashboardData.projectDistribution.labels.length
- })
- 
- // æœˆä»½æ•°é‡
- const monthCount = computed(() => {
-   return dashboardData.monthlyHours.labels.length
- })
- 
- // æ ¼å¼åŒ–æœˆä»½æ ‡ç­¾
- function formatMonthLabel(monthStr: string) {
-   if (!monthStr || monthStr.length < 7)
-     return monthStr
- 
-   const year = monthStr.substring(0, 4)
-   const month = monthStr.substring(5, 7)
- 
-   // å°†æœˆä»½æ˜ å°„ä¸ºä¸­æ–‡åç§°
-   const monthNames: Record<string, string> = {
-     '01': 'ä¸€æœˆ',
-     '02': 'äºŒæœˆ',
-     '03': 'ä¸‰æœˆ',
-     '04': 'å››æœˆ',
-     '05': 'äº”æœˆ',
-     '06': 'å…­æœˆ',
-     '07': 'ä¸ƒæœˆ',
-     '08': 'å…«æœˆ',
-     '09': 'ä¹æœˆ',
-     '10': 'åæœˆ',
-     '11': 'åä¸€æœˆ',
-     '12': 'åäºŒæœˆ',
-   }
- 
-   const monthName = monthNames[month] || month
-   return `${year}å¹´${monthName}`
- }
- 
- // åŠ è½½ä»ªè¡¨ç›˜æ•°æ®
- async function loadData() {
-   isLoading.value = true
- 
-   try {
-     // ä½¿ç”¨å¯é€‰çš„ç­›é€‰æ¡ä»¶åŠ è½½æ•°æ®
-     const filter = dateFilter.start && dateFilter.end
-       ? {
-           start: dateFilter.start,
-           end: dateFilter.end,
-         }
-       : undefined
- 
-     const projectFilter = selectedProjects.value.length > 0
-       ? selectedProjects.value
-       : undefined
- 
-     const data = await loadDashboardData(filter, projectFilter)
- 
-     // æ›´æ–°ä»ªè¡¨ç›˜æ•°æ®
-     dashboardData.hoursTrend.labels = data.hoursTrend.labels
-     dashboardData.hoursTrend.data = data.hoursTrend.data
-     dashboardData.projectDistribution.labels = data.projectDistribution.labels
-     dashboardData.projectDistribution.data = data.projectDistribution.data
-     dashboardData.projectDistribution.percentages = data.projectDistribution.percentages
-     dashboardData.projectDistribution.backgroundColor = data.projectDistribution.backgroundColor
- 
-     // æ›´æ–°æœˆåº¦æ•°æ®å¹¶æ ¼å¼åŒ–æ ‡ç­¾
-     dashboardData.monthlyHours.data = data.monthlyHours.data
-     dashboardData.monthlyHours.labels = data.monthlyHours.labels.map(formatMonthLabel)
- 
-     dashboardData.dateRange = data.dateRange
-     dashboardData.availableProjects = data.availableProjects
- 
-     // å¦‚æœé¡¹ç›®æ•°é‡è¿‡å¤šï¼Œåˆ‡æ¢ä¸ºæ°´å¹³æ¡å½¢å›¾è€Œä¸æ˜¯é¥¼å›¾
-     projectChartSettings.isDoughnut = projectCount.value <= 10
- 
-     // å¦‚æœæ²¡æœ‰è®¾ç½®æ—¥æœŸç­›é€‰ï¼Œåˆå§‹åŒ–ä¸ºæ•°æ®çš„æ—¥æœŸèŒƒå›´
-     if (!dateFilter.start)
-       dateFilter.start = data.dateRange.start
- 
-     if (!dateFilter.end)
-       dateFilter.end = data.dateRange.end
-   }
-   catch (error) {
-     console.error('åŠ è½½æ•°æ®å¤±è´¥:', error)
-   }
-   finally {
-     isLoading.value = false
-   }
- }
- 
- // å¤„ç†ç­›é€‰å™¨å˜åŒ–
- function applyFilters() {
-   loadData()
- }
- 
- // é‡ç½®ç­›é€‰å™¨
- function resetFilters() {
-   dateFilter.start = dashboardData.dateRange.start
-   dateFilter.end = dashboardData.dateRange.end
-   selectedProjects.value = []
-   loadData()
- }
- 
- // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
- onMounted(() => {
-   loadData()
- })
  
  // åˆå§‹åŒ–æ•°æ®å’ŒçŠ¶æ€
```

---

Executing checklist items 8-9. Cleaning up comments and verifying the template section.

---

Read file: src/views/work-visualization/index.vue

---

The template section looks good and is already using the new implementation with the JSON-based data. All the necessary components and data bindings are in place.

[MODE: REVIEW]

I've reviewed the implementation and the changes made to the file:

1. âœ… Removed unused imports (LineChart, DoughnutChart, BarChart, loadDashboardData)
2. âœ… Removed unused interface definitions (HoursTrendData, ProjectDistributionData, MonthlyHoursData, DateRange)
3. âœ… Removed the entire dashboard data structure and related code
4. âœ… Removed unused chart settings
5. âœ… Removed unused computed properties
6. âœ… Removed unused functions
7. âœ… Removed redundant onMounted code
8. âœ… The comments are already appropriate for the JSON implementation
9. âœ… The template section is properly using the JSON-based implementation

Implementation perfectly matches the final plan. The file has been successfully optimized by removing all redundant code related to the older Excel/CSV processing approach, while keeping the newer JSON-based implementation intact.

The optimized file now focuses solely on:
1. Loading JSON data directly
2. Filtering data based on user selections
3. Passing filtered data to visualization components

All functionality in the template is preserved, and the code is now cleaner and more maintainable.

---

